<?php
include_once "../include/header.html";
$PAGE_CODE_1 = "04";
$PAGE_CODE_2 = "0401";
?>
<main id="subPage" class="statistics year">
    <section class="sub_banner">
        <div class="bg">
            <img src="../images/statistics/statistics_banner.png" alt="통계/현황 베너">
        </div>
        <?php include_once "../include/tabmenu.html" ?>
    </section>
    <section class="s01">
        <article>
            <div class="wrap">
                <div class="title">연도별 추이</div>
            </div>
        </article>
    </section>
    <section class="s02">
        <article>
            <div class="wrap">
                <ul class="info">
                    <li>
                        <div class="caption">
                            <h3>연도별 사업자 및 사업장수</h3>
                            <ul class="line colorType01">
                                <li>사업장 수</li>
                                <li>사업자 수</li>
                            </ul>
                        </div>
                        <canvas id="year_chart" class="canvas-chart"></canvas>
                        <div class="table-box">
                            <table class="table01">
                                <colgroup>
                                    <col width="15%">
                                    <col>
                                    <col>
                                </colgroup>
                                <thead>
                                    <tr>
                                        <th>연도</th>
                                        <th>사업장 수</th>
                                        <th>사업자 수</th>

                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>2018</td>
                                        <td>108</td>
                                        <td>77</td>
                                    </tr>
                                    <tr>
                                        <td>2017</td>
                                        <td>106</td>
                                        <td>75</td>
                                    </tr>
                                    <tr>
                                        <td>2016</td>
                                        <td>103</td>
                                        <td>73</td>
                                    </tr>
                                    <tr>
                                        <td>2015</td>
                                        <td>95</td>
                                        <td>66</td>
                                    </tr>
                                    <tr>
                                        <td>2014</td>
                                        <td>91</td>
                                        <td>64</td>
                                    </tr>
                                    <tr>
                                        <td>2013</td>
                                        <td>89</td>
                                        <td>63</td>
                                    </tr>
                                    <tr>
                                        <td>2012</td>
                                        <td>85</td>
                                        <td>58</td>
                                    </tr>
                                </tbody>
                            </table>

                        </div>
                    </li>
                    <li>
                        <div class="caption">
                            <h3>연도별 연료사용량</h3>
                            <ul class="bar colorType02">
                                <li>CHP</li>
                                <li>열전용보일러</li>
                                <li>기타</li>
                            </ul>
                        </div>
                        <canvas id="year_chart2" class="canvas-chart"></canvas>
                        <div class="table-box">
                            <table class="table02">
                                <colgroup>
                                    <col width="15%">
                                    <col>
                                    <col>
                                    <col>
                                    <col>
                                </colgroup>
                                <thead>
                                    <tr>
                                        <th>연도</th>
                                        <th>CHP</th>
                                        <th>열전용보일러</th>
                                        <th>기타</th>
                                        <th>합계</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>2018</td>
                                        <td>15,215,290</td>
                                        <td>1,357,285</td>
                                        <td>14,495</td>
                                        <td>16,587,070</td>
                                    </tr>
                                    <tr>
                                        <td>2017</td>
                                        <td>12,001,462</td>
                                        <td>2,343,182</td>
                                        <td>1,213</td>
                                        <td>14,345,857</td>
                                    </tr>
                                    <tr>
                                        <td>2016</td>
                                        <td>10,986,171</td>
                                        <td>2,450,262</td>
                                        <td>802,753</td>
                                        <td>14,239,186</td>
                                    </tr>
                                    <tr>
                                        <td>2015</td>
                                        <td>9,429,465</td>
                                        <td>905,204</td>
                                        <td>317,068</td>
                                        <td>10,651,737</td>
                                    </tr>
                                    <tr>
                                        <td>2014</td>
                                        <td>9,070,045</td>
                                        <td>1,045,446</td>
                                        <td>306,269</td>
                                        <td>10,421,760</td>
                                    </tr>
                                    <tr>
                                        <td>2013</td>
                                        <td>8,757,726</td>
                                        <td>2,111,868</td>
                                        <td>306,269</td>
                                        <td>11,147,600</td>
                                    </tr>
                                    <tr>
                                        <td>2012</td>
                                        <td>9,032,871</td>
                                        <td>1,493,158</td>
                                        <td>218,828</td>
                                        <td>10,744,857</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </li>
                    <li>
                        <div class="caption">
                            <h3>연도별 열 생산량 및 판매량</h3>
                            <ul class="line colorType01">
                                <li>생산량</li>
                                <li>판매량</li>
                            </ul>
                        </div>
                        <canvas id="year_chart3" class="canvas-chart"></canvas>
                        <div class="table-box">
                            <table class="table03">
                                <colgroup>
                                    <col width="15%">
                                    <col>
                                    <col>
                                </colgroup>
                                <thead>
                                    <tr>
                                        <th>연도</th>
                                        <th>생산량(Gcal)</th>
                                        <th>판매량(Gcal)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>2018</td>
                                        <td>117,424,830</td>
                                        <td>63,472,434</td>
                                    </tr>
                                    <tr>
                                        <td>2017</td>
                                        <td>109,876,840</td>
                                        <td>58,958,216</td>
                                    </tr>
                                    <tr>
                                        <td>2016</td>
                                        <td>92,452,733</td>
                                        <td>54,057,691</td>
                                    </tr>
                                    <tr>
                                        <td>2015</td>
                                        <td>80,379,048</td>
                                        <td>49,367,961</td>
                                    </tr>
                                    <tr>
                                        <td>2014</td>
                                        <td>79,267,197</td>
                                        <td>41,776,531</td>
                                    </tr>
                                    <tr>
                                        <td>2013</td>
                                        <td>274,652,138</td>
                                        <td>41,119,661</td>
                                    </tr>
                                    <tr>
                                        <td>2012</td>
                                        <td>69,034,660</td>
                                        <td>42,716,113</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </li>
                    <li>
                        <div class="caption">
                            <h3>연도별 전기 생산량 및 판매량</h3>
                            <ul class="line colorType01">
                                <li>생산량</li>
                                <li>판매량</li>
                            </ul>
                        </div>
                        <canvas id="year_chart4" class="canvas-chart"></canvas>
                        <div class="table-box">
                            <table class="table04">
                                <colgroup>
                                    <col width="15%">
                                    <col>
                                    <col>
                                </colgroup>
                                <thead>
                                    <tr>
                                        <th>연도</th>
                                        <th>생산량(MWh)</th>
                                        <th>판매량(MWh)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>2018</td>
                                        <td>53,622,951</td>
                                        <td>55,263,109</td>
                                    </tr>
                                    <tr>
                                        <td>2017</td>
                                        <td>47,290,531</td>
                                        <td>47,344,849</td>
                                    </tr>
                                    <tr>
                                        <td>2016</td>
                                        <td>39,040,780</td>
                                        <td>39,798,643 </td>
                                    </tr>
                                    <tr>
                                        <td>2015</td>
                                        <td>29,269,194</td>
                                        <td>29,443,213</td>
                                    </tr>
                                    <tr>
                                        <td>2014</td>
                                        <td>28,365,375</td>
                                        <td>29,061,237</td>
                                    </tr>
                                    <tr>
                                        <td>2013</td>
                                        <td>25,019,538</td>
                                        <td>27,745,081</td>
                                    </tr>
                                    <tr>
                                        <td>2012</td>
                                        <td>26,811,108</td>
                                        <td>28,445,330</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </li>
                </ul>
            </div>
        </article>
    </section>
</main>
<?php
include_once "../include/footer.html"
?>

<script>
    let year_chart = document.querySelectorAll(".canvas-chart"),
        data01_element = document.querySelectorAll(".table01 tbody tr"),
        data02_element = document.querySelectorAll(".table02 tbody tr"),
        data03_element = document.querySelectorAll(".table03 tbody tr"),
        data04_element = document.querySelectorAll(".table04 tbody tr");


    let data01_area = {
        label: [],
        data01: [],
        data02: [],
    }
    let data02_area = {
        label: [],
        data01: [],
        data02: [],
        data03: [],
    }
    let data03_area = {
        label: [],
        data01: [],
        data02: []
    }
    let data04_area = {
        label: [],
        data01: [],
        data02: []
    }
    data01_element.forEach((el, index) => {
        data01_area.label.push(el.querySelectorAll("td")[0].textContent.replace(/,/g, "").trim());
        data01_area.data01.push(el.querySelectorAll("td")[1].textContent.replace(/,/g, "").trim());
        data01_area.data02.push(el.querySelectorAll("td")[2].textContent.replace(/,/g, "").trim())
    });
    data02_element.forEach((el, index) => {
        data02_area.label.push(el.querySelectorAll("td")[0].textContent);
        data02_area.data01.push(el.querySelectorAll("td")[1].textContent.replace(/,/g, "").trim() / 1000000);
        data02_area.data02.push(el.querySelectorAll("td")[2].textContent.replace(/,/g, "").trim() / 1000000);
        data02_area.data03.push(el.querySelectorAll("td")[3].textContent.replace(/,/g, "").trim() / 1000000);
    });
    data03_element.forEach((el, index) => {
        data03_area.label.push(el.querySelectorAll("td")[0].textContent.replace(/,/g, "").trim());
        data03_area.data01.push(el.querySelectorAll("td")[1].textContent.replace(/,/g, "").trim() / 1000000);
        data03_area.data02.push(el.querySelectorAll("td")[2].textContent.replace(/,/g, "").trim() / 1000000);
    });
    data04_element.forEach((el, index) => {
        data04_area.label.push(el.querySelectorAll("td")[0].textContent.replace(/,/g, "").trim());
        data04_area.data01.push(el.querySelectorAll("td")[1].textContent.replace(/,/g, "").trim() / 1000000);
        data04_area.data02.push(el.querySelectorAll("td")[2].textContent.replace(/,/g, "").trim() / 1000000);
    });


    gradient_red = year_chart[0].getContext("2d").createLinearGradient(0, 0, 0, 300);
    gradient_red.addColorStop(0, 'rgba(234, 73, 77, 0.5)');
    gradient_red.addColorStop(1, 'rgba(255, 255, 255, 0)');

    gradient_blue = year_chart[0].getContext("2d").createLinearGradient(0, 0, 0, 450);
    gradient_blue.addColorStop(0, 'rgba(57, 146, 208, 0.5)');
    gradient_blue.addColorStop(1, 'rgba(255, 255, 255, 0)');


    const beforeDrawFunction = {
        beforeDraw: function(chart, args, options) {
            const ctx = chart.ctx;
            const canvas = chart.canvas;
            const chartArea = chart.chartArea;

            ctx.fillStyle = '#f8f8f8';
            ctx.fillRect(chartArea.left, chartArea.bottom,
                chartArea.right - chartArea.left, chartArea.top - chartArea.bottom);
        },
    };

    // chart.js 툴팁
    function tooltip(unit_value) {
        return {
            enabled: false,
            backgroundColor: "#fff",
            borderColor: "#707070",
            borderWidth: ".5",
            displayColors: false,
            padding: {
                top: 15,
                bottom: 15,
                left: 10,
                right: 10,
            },
            bodyColor: "#000",
            bodyFont: {
                size: 12,
                weight: 400,
                family: "ScoreDream",
            },
            callbacks: {
                title: function() {
                    return null;
                },
                label: function(context) {
                    let t = Number(context.formattedValue);
                    return `${context.label}/${context.dataset.label}/${t.toFixed(2) % 1 != 0 ? t.toFixed(2) : t.toFixed(0)}${unit_value}`;
                }
            },
            external: function(context) {
                let tooltipEl = document.getElementById('chartjs-tooltip');

                if (!tooltipEl) {
                    tooltipEl = document.createElement('div');
                    tooltipEl.id = 'chartjs-tooltip';
                    document.body.appendChild(tooltipEl);
                }
                const tooltipModel = context.tooltip;
                if (tooltipModel.opacity === 0) {
                    tooltipEl.style.opacity = 0;
                    return;
                }

                tooltipEl.classList.remove('above', 'below', 'no-transform');
                if (tooltipModel.yAlign) {
                    tooltipEl.classList.add(tooltipModel.yAlign);
                } else {
                    tooltipEl.classList.add('no-transform');
                }

                function getBody(bodyItem) {
                    return bodyItem.lines;
                }

                if (tooltipModel.body) {
                    const bodyLines = tooltipModel.body.map(getBody);
                    let borderColor = this.labelColors[0].borderColor,
                        hoverBackgroundColor = this.dataPoints[0].dataset.hoverBackgroundColor,
                        strongColor = borderColor == "rgba(0,0,0,0.1)" ? hoverBackgroundColor : borderColor;
                    bodyLines.forEach(function(el, index) {
                        let el_text = el[0].split("/");
                        tooltipEl.innerHTML = `
                            <div class="normal">
                                <div>${el_text[0]}</div> 
                                <div>${el_text[1]}</div>
                            </div>
                            <strong style="color:${strongColor}">${el_text[2]}</strong>
                        `;
                    });
                }

                const position = context.chart.canvas.getBoundingClientRect();
                tooltipEl.style.opacity = 1;
                tooltipEl.style.left = position.left + window.pageXOffset + tooltipModel.caretX - tooltipEl.getBoundingClientRect().width / 2 + 'px';
                tooltipEl.style.top = position.top + window.pageYOffset + tooltipModel.caretY + 10 + 'px';
            }
        }
    }

    // chart.js 폰트 + 반응형
    function font_size(context) {
        const width = context.chart.width;
        let size = 16;
        if (window.innerWidth <= 1024) {
            size = 14;
            if (window.innerWidth <= 767) {
                size = 12;
                if (window.innerWidth <= 450) {
                    size = 10;
                }
            }
        }
        return {
            size: size,
            family: 'ScoreDream',
            weight: '400',
        }
    };

    // cahrt.js 데이터 (수정)
    function line01_dataset(label, data, borderColor, pointBackgroundColor, gradient) {
        let pointRadius = 5;
        if (window.innerWidth <= 1024) {
            pointRadius = 4;
            if (window.innerWidth <= 767) {
                pointRadius = 3;
                if (window.innerWidth <= 450) {
                    pointRadius = 1.5;
                }
            }
        }
        return {
            label: label,
            data: data,
            borderColor: borderColor,
            pointBackgroundColor: pointBackgroundColor,
            borderWidth: 1.5,
            pointStyle: 'circle',
            fill: true,
            backgroundColor: gradient,
            pointRadius: pointRadius,
        }
    }

    // chart.js 축
    function line01_scales(max, min, stepSize, unit, stacked) {
        return {
            x: {
                stacked: stacked,
                offset: true,
                grid: {
                    color: 'transparent',
                },
                ticks: {
                    color: '#707070',
                    font: font_size,
                    padding: 10,
                },
            },
            y: {
                stacked: stacked,
                offset: true,
                max: max,
                min: min,
                grid: {
                    color: '#e0e0e0',
                },
                ticks: {
                    stepSize: stepSize,
                    color: '#707070',
                    font: font_size,
                    callback: function(context) {
                        return context + (unit == "" ? "" : unit) + ' ' + ' ' + ' '
                    },
                },

            },
        }
    }





    const year_chart1 = new Chart(year_chart[0].getContext('2d'), {
        type: 'line',
        data: {
            labels: data01_area.label.reverse(),
            datasets: [
                line01_dataset('사업장수', data01_area.data01.reverse(), '#DD2025', '#FFDFE0', gradient_red),
                line01_dataset('사업자수', data01_area.data02.reverse(), '#0e6cae', '#d7efff', gradient_blue),
            ],
        },
        options: {
            layout: {
                autoPadding: false,
            },
            plugins: {
                legend: {
                    display: false,
                },
                tooltip: tooltip(""),
            },
            scales: line01_scales(110, 50, 10, ""),
        },
        plugins: [beforeDrawFunction],
    });

    const year_chart2 = new Chart(year_chart[1].getContext('2d'), {
        type: 'bar',
        data: {
            labels: data02_area.label.reverse(),
            datasets: [{
                    label: 'CHP',
                    data: data02_area.data01.reverse(),
                    backgroundColor: "#9BC0DB",
                    hoverBackgroundColor: "#0E6CAE",
                },
                {
                    label: '열전용보일러',
                    data: data02_area.data02.reverse(),
                    backgroundColor: "#B4D7EF",
                    hoverBackgroundColor: "#4EA5E2",
                },
                {
                    label: '기타',
                    data: data02_area.data03.reverse(),
                    backgroundColor: "#C1EDEF",
                    hoverBackgroundColor: "#6FDBE1",
                },
            ]
        },
        options: {
            layout: {
                autoPadding: false,
            },
            plugins: {
                legend: {
                    display: false,
                },
                tooltip: tooltip("M"),
            },
            scales: line01_scales(15, 5, 5, "M", true),
        },
        plugins: [beforeDrawFunction],
    });

    const year_chart3 = new Chart(year_chart[2].getContext('2d'), {
        type: 'line',
        data: {
            labels: data03_area.label.reverse(),
            datasets: [
                line01_dataset('생산량(Gcal)', data03_area.data01.reverse(), '#DD2025', '#FFDFE0', gradient_red),
                line01_dataset('판매량(Gcal)', data03_area.data02.reverse(), '#0e6cae', '#d7efff', gradient_blue),
            ],
        },
        options: {
            layout: {
                autoPadding: false,
            },
            plugins: {
                legend: {
                    display: false,
                },
                tooltip: tooltip("M"),
            },
            scales: line01_scales(280, 40, 40, "M"),
        },
        plugins: [beforeDrawFunction],
    });

    const year_chart4 = new Chart(year_chart[3].getContext('2d'), {
        type: 'line',
        data: {
            labels: data04_area.label.reverse(),
            datasets: [
                line01_dataset('생산량(Gcal)', data04_area.data01.reverse(), '#DD2025', '#FFDFE0', gradient_red),
                line01_dataset('판매량(Gcal)', data04_area.data02.reverse(), '#0e6cae', '#d7efff', gradient_blue),
            ],
        },
        options: {
            layout: {
                autoPadding: false,
            },
            plugins: {
                legend: {
                    display: false,
                },
                tooltip: tooltip("M"),
            },
            scales: line01_scales(60, 20, 10, "M"),
        },
        plugins: [beforeDrawFunction],
    });
</script>

